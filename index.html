<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Guest Wi-Fi â€“ Test Portal (Cambium)</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 50px; background: #f8f9fa; margin: 0; }
    .container { max-width: 500px; margin: 40px auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 25px rgba(0,0,0,0.1); }
    h2 { color: #333; }
    p { color: #555; line-height: 1.5; }
    button { background: #007bff; color: white; padding: 14px 40px; font-size: 18px; border: none; border-radius: 8px; cursor: pointer; margin-top: 20px; }
    button:hover { background: #0056b3; }
    #debug { margin-top: 30px; font-size: 0.9em; color: #666; text-align: left; background: #f0f0f0; padding: 15px; border-radius: 8px; white-space: pre-wrap; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Welcome to Test Wi-Fi (Cambium External Portal)</h2>
    <p>Demo click-through page for Cambium cnPilot / cnMaestro testing. No real login required.</p>
    
    <button onclick="grantAccess()">Accept & Connect</button>
    
    <div id="debug">Loading params...</div>
    
    <p style="margin-top:40px; font-size:0.85em; color:#777;">
      This page expects Cambium redirect params (ga_ap_mac, ga_srvr, ga_Qv, etc.).<br>
      On click, it POSTs to http://&lt;AP-IP&gt;:880/cgi-bin/hotspot_login.cgi to authorize.
    </p>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const debugDiv = document.getElementById('debug');
    debugDiv.innerHTML = 'Received Cambium Query Params:\n' + JSON.stringify(Object.fromEntries(params), null, 2);

    function grantAccess() {
      const apIp = params.get('ga_srvr');      // AP IP (required for POST target)
      const gaQv  = params.get('ga_Qv');       // Critical encoded string for auth
      const gaOrigUrl = params.get('ga_orig_url') || 'http://neverssl.com';  // Fallback redirect after success

      if (!apIp || !gaQv) {
        alert("Missing required params!\nNeed ga_srvr (AP IP) and ga_Qv.\n\nCurrent URL:\n" + window.location.href + "\n\nDebug info:\n" + debugDiv.innerText);
        return;
      }

      // For click-through: POST minimal data (no ga_user/ga_pass needed if no RADIUS)
      const form = document.createElement('form');
      form.method = 'POST';
      form.action = `http://${apIp}:880/cgi-bin/hotspot_login.cgi`;

      // Add required/known fields (adjust if using RADIUS: add ga_user & ga_pass)
      addHiddenField(form, 'ga_Qv', gaQv);  // Must include this!

      // Optional: if you want to simulate success redirect
      // addHiddenField(form, 'some_other', 'value'); 

      document.body.appendChild(form);
      form.submit();

      // Fallback alert in case POST doesn't redirect automatically
      setTimeout(() => {
        alert("POST sent to AP!\nIf no redirect, try manually: " + gaOrigUrl);
        window.location.href = gaOrigUrl;
      }, 2000);
    }

    function addHiddenField(form, name, value) {
      const input = document.createElement('input');
      input.type = 'hidden';
      input.name = name;
      input.value = value || '';
      form.appendChild(input);
    }
  </script>
</body>
</html>
