<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Connecting to Wi-Fi...</title>   <!-- â† Changed title to reduce "Sign in" feel -->
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 60px 20px; background: #f8f9fa; margin: 0; color: #333; }
    .container { max-width: 400px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); }
    h2 { margin-bottom: 10px; }
    #status { font-size: 1.1em; margin: 20px 0; color: #007bff; }
    #debug { margin-top: 30px; font-size: 0.85em; color: #666; text-align: left; background: #f0f0f0; padding: 12px; border-radius: 6px; white-space: pre-wrap; max-height: 200px; overflow-y: auto; }
  </style>
</head>
<body onload="autoGrant()">   <!-- Auto-trigger on load for faster flow -->

  <div class="container">
    <h2>Connecting to Test Wi-Fi</h2>
    <p id="status">Accepting terms... Please wait...</p>
    
    <div id="debug">Loading Cambium params...</div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const debugDiv = document.getElementById('debug');
    debugDiv.innerHTML = 'Received Params:\n' + JSON.stringify(Object.fromEntries(params), null, 2);

    function autoGrant() {
      const apIp   = params.get('ga_srvr');
      const gaQv   = params.get('ga_Qv');
      const origUrl = params.get('ga_orig_url') || 'http://neverssl.com';

      if (!apIp || !gaQv) {
        document.getElementById('status').innerHTML = 'Error: Missing required params. Manual click needed.';
        return;
      }

      const form = document.createElement('form');
      form.method = 'POST';
      form.action = `http://${apIp}:880/cgi-bin/hotspot_login.cgi`;

      // Add ALL query params as hidden fields (some users report better success)
      params.forEach((value, key) => {
        if (key !== 'ga_srvr') {  // exclude ga_srvr from body, it's in URL
          addHiddenField(form, key, value);
        }
      });

      // Critical: ga_Qv must be in body for click-through
      addHiddenField(form, 'ga_Qv', gaQv);

      document.body.appendChild(form);
      form.submit();

      // Fallback if POST doesn't redirect fast enough
      setTimeout(() => {
        document.getElementById('status').innerHTML = 'Authorized! Redirecting...';
        window.location.href = origUrl;
      }, 3000);
    }

    function addHiddenField(form, name, value) {
      const input = document.createElement('input');
      input.type = 'hidden';
      input.name = name;
      input.value = value || '';
      form.appendChild(input);
    }
  </script>
</body>
</html>
